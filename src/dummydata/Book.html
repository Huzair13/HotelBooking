<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Booking</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        .carousel-item img {
            width: 100%;
            max-height: 500px;
            object-fit: cover;
        }

        .carousel-container {
            position: relative;
        }

        .view-all-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }

        .modal-dialog {
            max-width: 90%;
        }

        .gallery-thumbnails img {
            width: 100px;
            height: 75px;
            cursor: pointer;
            margin: 5px;
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }

        .gallery-thumbnails img:hover {
            border-color: #007bff;
        }

        .hotel-details {
            margin-top: 30px;
        }

        .highlight {
            font-weight: bold;
            color: #007bff;
        }

        .review {
            border-bottom: 1px solid #ddd;
            padding: 15px 0;
            position: relative;
            display: flex;
            align-items: flex-start;
        }

        .review:last-child {
            border-bottom: none;
        }

        .review-content {
            flex: 1;
            margin-right: 15px;
        }

        .review-feedback {
            max-height: 60px;
            overflow: hidden;
            position: relative;
        }

        .review-feedback.expanded {
            max-height: none;
        }

        .expand-btn {
            cursor: pointer;
            color: #007bff;
            text-decoration: underline;
            display: block;
            margin-top: 5px;
        }

        .expand-btn:hover {
            text-decoration: none;
        }


        .review-rating {
            font-size: 1.25rem;
            color: #ffd700;
            /* Gold color for stars */
            margin-bottom: 5px;
        }

        .review-date {
            font-size: 0.875rem;
            color: #6c757d;
            text-align: right;
        }

        .review-user {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .booking-form {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background: #f9f9f9;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);

            /* Ensure form is responsive with proper padding */
            @media (max-width: 576px) {
                margin-left: 15px;
                margin-right: 15px;
            }
        }

        .form-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .form-label {
            font-size: 1rem;
            color: #555;
        }

        .form-control {
            border-radius: 5px;
            border: 1px solid #ddd;
            padding: 10px;
            font-size: 1rem;
        }

        .number-input {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .number-input .btn {
            border-radius: 5px;
            padding: 0.5rem;
            background: #e0e0e0;
            color: #333;
            border: none;
            font-size: 1.25rem;
        }

        .number-input .form-control {
            width: 60px;
            text-align: center;
        }

        .number-input .btn:hover {
            background: #ccc;
        }

        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 1rem;
        }

        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #004085;
        }

        .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
            border-color: #545b62;
        }

        .hotel-details {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .hotel-name {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }

        .hotel-address,
        .hotel-price {
            font-size: 1.125rem;
            color: #555;
            margin-bottom: 10px;
        }

        .highlight {
            font-weight: bold;
            color: #007bff;
        }

        .price {
            font-size: 1.5rem;
        }

        .hotel-ratings {
            margin-bottom: 15px;
        }

        .rating-badge {
            display: inline-block;
            background: #ffcc00;
            /* Default color */
            color: #333;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        .star-ratings {
            margin-top: 5px;
        }

        .star-ratings i {
            color: #f5c518;
            font-size: 1.25rem;
            margin-right: 2px;
        }

        .hotel-amenities {
            font-size: 1.125rem;
            color: #555;
        }

        .amenities-icons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .amenities-icons i {
            font-size: 1.5rem;
            color: #007bff;
            background: #e9ecef;
            border-radius: 50%;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
        }

        .hotel-price {
            font-size: 1.5rem;
            /* Base font size for medium screens */
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }

        .highlight.price {
            font-size: 1.5rem;
            /* Larger font size for larger screens */
            color: #28a745;
            /* Green color for the price */
            background: #e9f5e9;
            /* Light green background */
            padding: 5px 10px;
            /* Padding for better spacing */
            border-radius: 5px;
            /* Rounded corners */
            border: 2px solid #28a745;
            /* Border matching the text color */
            display: inline-block;
            /* Adjust width to fit content */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            /* Slight shadow for depth */
            text-align: center;
            /* Center text inside the badge */
            word-wrap: break-word;
            /* Ensure text wraps properly */
            max-width: 100%;
            /* Ensure badge doesn't overflow */
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .hotel-price {
                font-size: 1.25rem;
                /* Smaller font size for smaller screens */
            }

            .highlight.price {
                font-size: 1.5rem;
                /* Adjust badge font size */
                padding: 8px 12px;
                /* Adjust padding */
            }
        }

        @media (max-width: 576px) {
            .hotel-price {
                font-size: 1rem;
                /* Further smaller font size */
            }

            .highlight.price {
                font-size: 1.25rem;
                /* Adjust badge font size */
                padding: 6px 10px;
                /* Adjust padding */
            }
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <!-- Carousel for displaying images -->
        <div id="hotelCarousel" class="carousel slide carousel-container">
            <div class="carousel-inner">
                <!-- Carousel items will be populated here -->
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#hotelCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#hotelCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
            <button type="button" class="btn btn-primary view-all-btn" data-bs-toggle="modal"
                data-bs-target="#galleryModal">
                View All Photos
            </button>
        </div>

        <div class="row mt-5">
            <!-- Hotel Details -->
            <div class="col-lg-6">
                <!-- Hotel Details -->
                <div class="hotel-details">
                    <h2 id="hotelName" class="hotel-name">Hotel Name</h2>
                    <p class="hotel-address">Address: <span id="hotelAddressValue" class="highlight"></span></p>
                    <p class="hotel-price">Starting Rent: <span id="hotelLeastRentValue" class="highlight price"></span>
                    </p>
                    <div class="hotel-ratings">
                        <p><span id="hotelAverageRatingsValue" class="rating-badge"></span></p>
                        <div id="hotelStarRatings" class="star-ratings">
                            <!-- Stars will be added dynamically -->
                        </div>
                    </div>
                    <div class="hotel-amenities">
                        <p>Amenities:</p>
                        <div id="hotelAmenitiesValue" class="amenities-icons">
                            <!-- Icons will be added dynamically -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6 col-md-8 col-sm-10 mx-auto booking-form">
                <h3 class="form-title">Check Availability</h3>
                <form id="bookingForm">
                    <div class="mb-4">
                        <label for="checkinDate" class="form-label">Check-in Date</label>
                        <input type="date" id="checkinDate" class="form-control">
                    </div>
                    <div class="mb-4">
                        <label for="checkoutDate" class="form-label">Check-out Date</label>
                        <input type="date" id="checkoutDate" class="form-control">
                    </div>
                    <div class="mb-4">
                        <label class="form-label">Number of Guests</label>
                        <div class="number-input">
                            <button type="button" class="btn btn-secondary" id="decreaseGuests">-</button>
                            <input type="number" id="numGuests" class="form-control" value="1" min="1">
                            <button type="button" class="btn btn-secondary" id="increaseGuests">+</button>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label">Number of Rooms</label>
                        <div class="number-input">
                            <button type="button" class="btn btn-secondary" id="decreaseRooms">-</button>
                            <input type="number" id="numRooms" class="form-control" value="1" min="1">
                            <button type="button" class="btn btn-secondary" id="increaseRooms">+</button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary" id="checkAvailability">Check Availability</button>
                </form>
            </div>
            

        </div>


        <!-- Reviews Section -->
        <div class="hotel-reviews mt-5">
            <h3>Reviews</h3>
            <div id="reviewsContainer">
                <!-- Reviews will be populated here -->
            </div>
            <a href="#" id="viewAllReviews" class="btn btn-primary mt-3" style="display: none;">View All Reviews</a>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div class="modal fade" id="galleryModal" tabindex="-1" aria-labelledby="galleryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="galleryModalLabel">Hotel Photos</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex flex-column align-items-center">
                        <img id="modalMainImage" class="img-fluid" src="" alt="Large Hotel Image">
                        <div id="modalThumbnails" class="d-flex flex-wrap gallery-thumbnails mt-3">
                            <!-- Thumbnails will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    <script>
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        async function fetchHotelDetails(hotelId) {
            try {
                const hotelResponse = await fetch(`https://huzairhotelbookingapi.azure-api.net/Hotel/api/GetHotelByID/${hotelId}`);
                const hotel = await hotelResponse.json();

                if (hotel) {
                    // Populate carousel with hotel images
                    const carouselInner = document.querySelector('.carousel-inner');
                    carouselInner.innerHTML = '';
                    hotel.hotelImages.forEach((imageUrl, index) => {
                        const carouselItem = document.createElement('div');
                        carouselItem.classList.add('carousel-item');
                        if (index === 0) carouselItem.classList.add('active');
                        carouselItem.innerHTML = `<img src="${imageUrl}" class="d-block w-100" alt="Hotel Image">`;
                        carouselInner.appendChild(carouselItem);
                    });

                    new bootstrap.Carousel(document.querySelector('#hotelCarousel'), {
                        interval: 3000, // Set the interval to 3000 milliseconds (3 seconds)
                        ride: 'carousel' // Ensure the carousel starts automatically
                    });

                    // Populate modal with thumbnails
                    const modalMainImage = document.getElementById('modalMainImage');
                    const modalThumbnails = document.getElementById('modalThumbnails');
                    modalMainImage.src = hotel.hotelImages[0] || '';
                    modalThumbnails.innerHTML = '';
                    hotel.hotelImages.forEach(imageUrl => {
                        const thumbnailImg = document.createElement('img');
                        thumbnailImg.src = imageUrl;
                        thumbnailImg.alt = 'Hotel Thumbnail';
                        thumbnailImg.classList.add('img-fluid');
                        thumbnailImg.dataset.large = imageUrl;
                        thumbnailImg.addEventListener('click', () => {
                            modalMainImage.src = thumbnailImg.dataset.large;
                        });
                        modalThumbnails.appendChild(thumbnailImg);
                    });

                    // Fetch and display additional details
                    const [roomsResponse, amenitiesResponse, reviewsResponse] = await Promise.all([
                        fetch('https://huzairhotelbookingapi.azure-api.net/Hotel/api/GetAllRooms'),
                        fetch('https://huzairhotelbookingapi.azure-api.net/Hotel/api/GetAllAmenities'),
                        fetch(`https://huzairhotelbookingapi.azure-api.net/Rating/api/GetRatingByHotelID/${hotelId}`)
                    ]);

                    const rooms = await roomsResponse.json();
                    const amenities = await amenitiesResponse.json();
                    const reviews = await reviewsResponse.json();
                    const hotelRoomIds = hotel.roomIDs; // Assuming hotel is an array of room IDs

                    // Filter rooms to only include those in the hotel
                    const hotelRooms = rooms.filter(room => hotelRoomIds.includes(room.roomNumber));

                    // Find the room with the minimum rent
                    const minRentRoom = hotelRooms.reduce((minRoom, currentRoom) => {
                        return (minRoom.rent < currentRoom.rent) ? minRoom : currentRoom;
                    }, { rent: Infinity });

                    const leastRent = minRentRoom ? minRentRoom.rent : 'N/A';

                    // Find amenities details
                    const hotelAmenities = hotel.amenities.map(id => {
                        const amenity = amenities.find(amenity => amenity.id === id);
                        return amenity ? amenity.name : 'Unknown';
                    }).join(', ');

                    // Update hotel details section
                    console.log(hotel)
                    document.getElementById('hotelName').textContent = hotel.name;
                    document.getElementById('hotelAddressValue').textContent = hotel.address;
                    // Format and set the least rent value
                    const leastRentElement = document.getElementById('hotelLeastRentValue');
                    leastRentElement.textContent = `$${leastRent}`;

                    document.getElementById('hotelAverageRatingsValue').textContent = `${hotel.averageRatings}/5`;

                    const ratingBadge = document.getElementById('hotelAverageRatingsValue');
                    let badgeColor = '#ffcc00'; // Default color
                    if (hotel.averageRatings >= 4.5) {
                        badgeColor = '#28a745'; // Green for high value
                    } else if (hotel.averageRatings >= 3) {
                        badgeColor = '#ffc107'; // Yellow for medium value
                    } else {
                        badgeColor = '#dc3545'; // Red for low value
                    }
                    ratingBadge.style.backgroundColor = badgeColor;

                    const starRatings = document.getElementById('hotelStarRatings');
                    const fullStars = Math.floor(hotel.averageRatings);
                    const halfStar = hotel.averageRatings % 1 !== 0;
                    let starsHTML = '';

                    for (let i = 0; i < fullStars; i++) {
                        starsHTML += '<i class="fas fa-star"></i>';
                    }
                    if (halfStar) {
                        starsHTML += '<i class="fas fa-star-half-alt"></i>';
                    }
                    for (let i = fullStars + (halfStar ? 1 : 0); i < 5; i++) {
                        starsHTML += '<i class="far fa-star"></i>';
                    }

                    starRatings.innerHTML = starsHTML;

                    const amenitiesIcons = {
                        "AC": "fas fa-snowflake",
                        "TV": "fas fa-tv",
                        "Fan": "fas fa-fan",
                        "Geyser": "fas fa-tachometer-alt",
                        "Wifi": "fas fa-wifi",
                        "Play Station": "fas fa-gamepad"
                    };
                    const amenitiesContainer = document.getElementById('hotelAmenitiesValue');
                    amenitiesContainer.innerHTML = Object.keys(amenitiesIcons)
                        .filter(amenity => hotelAmenities.includes(amenity))
                        .map(amenity => `<i class="${amenitiesIcons[amenity]}" title="${amenity}"></i>`)
                        .join(' ');

                    // Populate reviews section
                    const reviewsContainer = document.getElementById('reviewsContainer');
                    reviewsContainer.innerHTML = '';
                    reviews.slice(0, 3).forEach(review => {
                        const date = new Date(review.createdAt).toLocaleDateString();
                        const time = new Date(review.createdAt).toLocaleTimeString();
                        const reviewElement = document.createElement('div');
                        reviewElement.classList.add('review');
                        reviewElement.innerHTML = `
                            <div class="review-content">
                                <div class="review-user">User ${review.userId}</div>
                                <div class="review-feedback">
                                    <p class="review-feedback" data-full="${review.feedback}">${review.feedback.slice(0, 100)}</p>
                                    <span class="expand-btn">Read More</span>
                                </div>
                            </div>
                            <div class="d-flex flex-column align-items-end">
                                <div class="review-rating">${'⭐'.repeat(review.ratingValue)}</div>
                                <div class="review-date">${date} <br> ${time}</div>
                            </div>
                        `;
                        reviewsContainer.appendChild(reviewElement);
                    });

                    if (reviews.length > 3) {
                        document.getElementById('viewAllReviews').style.display = 'block';
                    }
                }
            } catch (error) {
                console.error('Error fetching hotel details:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('token');
            const hotelId = getQueryParam('hotelId');
            const viewAllReview = document.getElementById('viewAllReviews');
            viewAllReview.addEventListener('click', (event) => {
                event.preventDefault();
                window.location.href = `reviews.html?hotelId=${hotelId}`;
            });

            const decreaseGuestsBtn = document.getElementById('decreaseGuests');
            const increaseGuestsBtn = document.getElementById('increaseGuests');
            const numGuestsInput = document.getElementById('numGuests');

            const decreaseRoomsBtn = document.getElementById('decreaseRooms');
            const increaseRoomsBtn = document.getElementById('increaseRooms');
            const numRoomsInput = document.getElementById('numRooms');

            decreaseGuestsBtn.addEventListener('click', () => {
                numGuestsInput.value = Math.max(1, parseInt(numGuestsInput.value) - 1);
            });

            increaseGuestsBtn.addEventListener('click', () => {
                numGuestsInput.value = parseInt(numGuestsInput.value) + 1;
            });

            decreaseRoomsBtn.addEventListener('click', () => {
                numRoomsInput.value = Math.max(1, parseInt(numRoomsInput.value) - 1);
            });

            increaseRoomsBtn.addEventListener('click', () => {
                numRoomsInput.value = parseInt(numRoomsInput.value) + 1;
            });

            document.getElementById('checkAvailability').addEventListener('click', async () => {
                const checkinDate = document.getElementById('checkinDate').value;
                const checkoutDate = document.getElementById('checkoutDate').value;
                const numGuests = document.getElementById('numGuests').value;
                const numRooms = document.getElementById('numRooms').value;

                const requestBody = {
                    hotelId: hotelId,
                    checkInDate: checkinDate,
                    checkOutDate: checkoutDate,
                    numOfGuests: numGuests,
                    numOfRooms: numRooms
                };

                console.log(requestBody)
                try {
                    const response = await fetch('https://huzairhotelbookingapi.azure-api.net/Hotel/api/CheckHotelAvailability', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}` ,
                            'Ocp-Apim-Subscription-Key': 'a3c8139fd03b40e7aeb11519eab98f77'

                        },
                        body: JSON.stringify(requestBody)
                    });

                    console.log(response)

                    const result = await response.json();
                    const isAvailable = response.status === 200 ? result : false;
                    console.log(isAvailable)

                    const queryString = new URLSearchParams({
                        hotelId: hotelId,
                        checkInDate: checkinDate,
                        checkOutDate: checkoutDate,
                        numOfGuests: numGuests,
                        numOfRooms: numRooms,
                        isAvailable: isAvailable
                    }).toString();

                    window.location.href = `availabilityResult.html?${queryString}`;
                } catch (error) {
                    console.error('Error:', error);
                }
            });

            if (hotelId) {
                fetchHotelDetails(hotelId);
            }

            document.getElementById('reviewsContainer').addEventListener('click', event => {
                if (event.target.classList.contains('expand-btn')) {
                    const feedback = event.target.previousElementSibling;
                    feedback.classList.toggle('expanded');
                    event.target.textContent = feedback.classList.contains('expanded') ? 'Read Less' : 'Read More';
                }
            });


            document.getElementById('viewAllReviews').addEventListener('click', () => {
                // Handle the action for viewing all reviews
            });
        });
    </script>
</body>

</html>